<div class="flex flex-col gap-4">
  <label class="flex items-center gap-3 rounded-2xl bg-base-100/90 px-4 py-2 text-sm text-base-content/80">
    <input type="checkbox" id="stop-after-clip" class="checkbox checkbox-primary checkbox-sm">
    クリップ再生終了で自動停止する
  </label>

  <div id="clip-list" class="flex flex-col gap-3 overflow-y-auto pr-1 lg:max-h-[60vh]">
  <% clips.each do |clip| %>
    <% start_input_id = "clip_edit_start_time_\#{clip.id || clip.object_id}" %>
    <% end_input_id   = "clip_edit_end_time_\#{clip.id || clip.object_id}" %>
    <article class="clip-item group rounded-2xl border border-base-200 bg-base-100 p-4 shadow-sm transition hover:border-primary/60 hover:shadow-md" data-clip-id="<%= clip.id %>">
      <div class="flex flex-col gap-3 sm:grid sm:grid-cols-[minmax(0,1fr)_auto] sm:items-start sm:gap-3">
        <div class="flex min-w-0 flex-col gap-2">
          <p class="clip-title break-words text-base font-semibold text-base-content" data-clip-title="<%= clip.title %>"><%= clip.title %></p>
          <dl class="grid grid-cols-[auto_1fr] items-center gap-x-3 gap-y-2 text-sm text-base-content/70 sm:grid-cols-[auto_minmax(0,1fr)]">
            <dt class="font-medium text-base-content">開始</dt>
            <dd class="min-w-0">
              <span class="play-clip start-clip inline-flex items-center justify-center rounded-lg bg-base-200 px-3 py-1 font-mono text-sm tracking-tight text-base-content w-full sm:w-auto" data-start="<%= clip.start_time %>" data-end="<%= clip.end_time %>">
                <span class="tabular-nums"><%= clip.seconds_to_hms(clip.start_time) %></span>
              </span>
            </dd>
            <dt class="font-medium text-base-content">終了</dt>
            <dd class="min-w-0">
              <span class="play-clip inline-flex items-center justify-center rounded-lg bg-base-200 px-3 py-1 font-mono text-sm tracking-tight text-base-content w-full sm:w-auto" data-start="<%= clip.start_time %>" data-end="<%= clip.end_time %>">
                <span class="tabular-nums"><%= clip.seconds_to_hms(clip.end_time) %></span>
              </span>
            </dd>
          </dl>
        </div>
        <div class="drag-handle group/handle flex cursor-grab select-none items-center justify-end rounded-xl px-3 py-2 text-sm font-medium text-base-content/70 transition hover:bg-base-200 active:cursor-grabbing sm:h-full sm:min-h-[3.5rem]" role="button" tabindex="0" aria-label="ドラッグで並べ替え">
          <span class="hidden text-xs uppercase tracking-wide text-base-content/50 sm:inline">ドラッグ</span>
          <span aria-hidden="true" class="ml-2 text-base">⋮⋮</span>
        </div>
      </div>

      <div class="mt-3 grid gap-2 sm:grid-cols-2">
        <button class="play-clip start-clip btn btn-sm btn-primary w-full sm:w-auto" data-start="<%= clip.start_time %>" data-end="<%= clip.end_time %>" type="button">再生</button>
        <button class="loop-btn btn btn-sm btn-outline w-full sm:w-auto" type="button">ループ</button>
        <button class="edit-clip btn btn-sm btn-outline w-full sm:w-auto" type="button">編集</button>
        <button class="delete-clip btn btn-sm btn-outline btn-error w-full sm:w-auto" type="button">削除</button>
      </div>

      <form class="clip-edit-form mt-4 space-y-5 rounded-xl border border-base-200 bg-base-100 p-4 sm:p-5" hidden>
        <div class="flex flex-col gap-2">
          <% title_input_id = "clip_edit_title_\#{clip.id || clip.object_id}" %>
          <label class="text-sm font-semibold text-base-content" for="<%= title_input_id %>">タイトル</label>
          <input name="clip[title]" value="" class="input input-bordered w-full" id="<%= title_input_id %>" placeholder="例: オープニングのハイライト" />
        </div>
        <div class="grid gap-4 md:grid-cols-2">
          <div class="flex flex-col gap-2">
            <label class="text-sm font-semibold text-base-content" for="<%= start_input_id %>">開始</label>
            <div class="grid gap-2 md:grid-cols-[minmax(0,1fr)_auto] md:items-end md:gap-3">
              <div class="form-control">
                <label class="label mb-0 pb-1" for="<%= start_input_id %>">
                  <span class="label-text text-xs text-base-content/70 md:text-sm">開始時間</span>
                  <span class="label-text-alt text-[10px] md:text-xs text-base-content/50">mm:ss.ss</span>
                </label>
                <input name="clip[start_time]" value="" class="input input-bordered w-full text-right font-mono tabular-nums" id="<%= start_input_id %>" placeholder="00:00.00" />
              </div>
              <button type="button" class="btn btn-outline btn-sm h-10 min-h-0 use-current-start w-full md:w-auto md:max-w-[160px] md:flex-shrink-0" title="現在位置を開始に設定" aria-label="現在位置を開始に設定">▶ 今の位置</button>
            </div>
          </div>
          <div class="flex flex-col gap-2">
            <label class="text-sm font-semibold text-base-content" for="<%= end_input_id %>">終了</label>
            <div class="grid gap-2 md:grid-cols-[minmax(0,1fr)_auto] md:items-end md:gap-3">
              <div class="form-control">
                <label class="label mb-0 pb-1" for="<%= end_input_id %>">
                  <span class="label-text text-xs text-base-content/70 md:text-sm">終了時間</span>
                  <span class="label-text-alt text-[10px] md:text-xs text-base-content/50">mm:ss.ss</span>
                </label>
                <input name="clip[end_time]" value="" class="input input-bordered w-full text-right font-mono tabular-nums" id="<%= end_input_id %>" placeholder="00:30.00" />
              </div>
              <button type="button" class="btn btn-outline btn-sm h-10 min-h-0 use-current-end w-full md:w-auto md:max-w-[160px] md:flex-shrink-0" title="現在位置を終了に設定" aria-label="現在位置を終了に設定">▶ 今の位置</button>
            </div>
          </div>
        </div>
        <div class="errors space-y-1 text-sm text-error" aria-live="polite"></div>
        <div class="flex flex-col gap-2 sm:flex-row sm:flex-wrap sm:justify-end">
          <button type="submit" class="btn btn-primary btn-sm w-full sm:w-auto">保存</button>
          <button type="button" class="cancel-edit btn btn-ghost btn-sm w-full sm:w-auto">キャンセル</button>
        </div>
      </form>
    </article>
  <% end %>
  </div>
</div>
